# üßæ Log Analyzer

**Log Analyzer** ‚Äî —ç—Ç–æ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ NGINX.  
–û–Ω–æ —á–∏—Ç–∞–µ—Ç `.log` –∏–ª–∏ `.txt` —Ñ–∞–π–ª—ã, –≤—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º, —Ä–∞–∑–º–µ—Ä–∞–º –æ—Ç–≤–µ—Ç–æ–≤, –∫–æ–¥–∞–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –¥–∞—Ç–∞–º,  
–∞ –∑–∞—Ç–µ–º —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –≤ –æ–¥–Ω–æ–º –∏–∑ —Ñ–æ—Ä–º–∞—Ç–æ–≤ (`json`, `markdown`, `adoc`).

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ß—Ç–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª–æ–≥-—Ñ–∞–π–ª–æ–≤ (–≤–∫–ª—é—á–∞—è —à–∞–±–ª–æ–Ω—ã `**/*.txt`, `**/*.log`);
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç (`--from` / `--to`);
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ—Ç—á—ë—Ç–∞:
  - `json`
  - `markdown`
  - `adoc`
- –ü–æ–¥—Å—á—ë—Ç:
  - –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –¥–∞—Ç–∞–º –∏ —Ä–µ—Å—É—Ä—Å–∞–º,
  - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –∫–æ–¥–∞–º –æ—Ç–≤–µ—Ç–∞,
  - —Ä–∞–∑–º–µ—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (`avg`, `max`, `p95`),
  - —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤;
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ –ø—É—Ç–µ–π (`glob`, –Ω–∞–ø—Ä–∏–º–µ—Ä `logs/**/*.txt`);
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π;
- –£–¥–æ–±–Ω—ã–π CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo_url>
cd logs

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Poetry
curl -sSL https://install.python-poetry.org | python -

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
poetry install --no-root

# –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑
poetry run python -m src.main     -p ./scripts/data/input/logs/**/*.txt     -f json     -o ./scripts/data/output/report.json
```

---

## üê≥ –†–∞–±–æ—Ç–∞ —Å Docker

### –°–±–æ—Ä–∫–∞

```bash
docker build --target app . -t logs-app
```

### –ó–∞–ø—É—Å–∫

```bash
docker run --rm \
  -v "$(pwd)/scripts/data:/tmp/data" \
  -v "$(pwd)/scripts/data/input:/tmp/input:ro" \
  logs-app:latest \
  -p '/tmp/input/logs**.txt' \
  -f json \
  -o /tmp/data/output/stats.json
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ `scripts/data/output` –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç—á—ë—Ç `stats.json`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit-—Ç–µ—Å—Ç—ã

```bash
docker build --target tests . -t logs-app-tests
docker run --rm logs-app-tests
```

–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
poetry run pytest -q
```

### Black Box Tests (–ø—Ä–∏—ë–º–æ—á–Ω—ã–µ)

```bash
bash ./scripts/run_acceptance_tests.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏,  
–≤–∫–ª—é—á–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á—ë—Ç–∞.

---

## üß± CI/CD (GitLab)

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç `.gitlab-ci.yml`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏ —Å—Ç–∞–¥–∏–∏:

| –°—Ç–∞–¥–∏—è            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                  |
|--------------------|---------------------------------------------|
| `pre`              | –≤—ã–≤–æ–¥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è CI              |
| `tests`            | —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ   |
| `blackbox-tests`   | –ø–æ–ª–Ω–æ–µ end-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Docker |

–í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø—É—à–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ src/                     # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (CLI)
‚îÇ   ‚îú‚îÄ‚îÄ cli/                 # –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –∫–æ–º–∞–Ω–¥–∞ run()
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input/           # –¢–µ—Å—Ç–æ–≤—ã–µ –ª–æ–≥–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ output/          # –û–∂–∏–¥–∞–µ–º—ã–µ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ run_acceptance_tests.sh  # –°–∫—Ä–∏–ø—Ç black-box —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ tests/                   # Unit-—Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ poetry.lock
‚îî‚îÄ‚îÄ Dockerfile
```

---

## üß∞ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CLI

```bash
python -m src.main \
  -p './scripts/data/input/logs/**/*.txt' \
  -o ./scripts/data/output/report.json \
  -f json --from 2015-05-01 --to 2015-05-17
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (JSON):**

```json
{
  "files": ["part1.txt", "part2.txt"],
  "totalRequestsCount": 256,
  "responseSizeInBytes": {
    "average": 206.05,
    "max": 3318,
    "p95": 382
  },
  "resources": [
    {"resource": "/downloads/product_1", "totalRequestsCount": 145},
    {"resource": "/downloads/product_2", "totalRequestsCount": 111}
  ]
}
```
